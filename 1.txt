SELECT TTD.TESTDETAILID,
	TTA.ATTEMPTID,
	TTD.PARTNERINTEGRATIONID,
	TTD.STUDENTNAME,
	TTNI.TESTNAME,
	REVIEWSTATUS,
 TS.SCHEDULENAME,
	O.ORGANISATIONNAME,
	COUNT(TTA.ATTEMPTID) AS ATTEMPT_COUNT,
	MAX(TTA.ATTEMPTID) AS LAST_ATTEMPTID
FROM RPT.TBLTESTDETAILS TTD
INNER JOIN RPT.TBLTESTNAMEINFORMATION TTNI ON TTD.TESTNAMEINFORMATIONID = TTNI.TESTNAMEINFORMATIONID
INNER JOIN RPT.TBLTESTATTEMPTS TTA ON TTD.TESTDETAILID = TTA.TESTDETAILSID
INNER JOIN RPT.TBLTESTASSIGNMENT TA ON TTA.TESTDETAILSID = TA.TESTDETAILID
INNER JOIN RPT.TBLSCHEDULEUSER TSU ON TTD.PARTNERINTEGRATIONID::bigint = TSU.SCHEDULEUSERID
INNER JOIN RPT.TBLSCHEDULEDETAILS TSD ON TSU.SCHEDULEDETAILID = TSD.SCHEDULEDETAILID
INNER JOIN RPT.TBLSCHEDULE TS ON TSD.SCHEDULEID = TS.SCHEDULEID
INNER JOIN RPT.TBLORGANISATION O ON TTD.ORGANISATIONID = O.ORGANISATIONID
GROUP BY TTD.TESTDETAILID,
	TTD.PARTNERINTEGRATIONID,
	TTA.ATTEMPTID,
	TTD.STUDENTNAME,
	TTNI.TESTNAME,
	REVIEWSTATUS,
	TS.SCHEDULENAME,
	O.ORGANISATIONNAME
